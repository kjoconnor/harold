{% extends "base.html" %}
{% import "utils.html" as utils %}

{% block content %}
  {% if username_overridden: %}
  <nav class="banner">
    You are viewing @{{username}}'s salon. <a href="/" target="_self">Go back to your salon.</a>
  </nav>
  {% endif %}

  <section class="listing">
    {% if not username_overridden: %}
    <h2>to review (<abbr title="as soon as possible">asap</abbr>, within one business day)</h2>
    {% else %}
    <h2>@{{username}} needs to review</h2>
    {% endif %}
    {% for state, blocker in [("haircut", True), ("unreviewed", True), ("nail_care", False), ("fish", False)]: %}
    <details {{ "open" if blocker or not to_review[state] else "" }}>
      <summary>
        <h3 class="state-{{ state }}">{{ state_meanings[state] }} <span class="count">({{ to_review[state] | length }})</span></h3>
      </summary>
      {% for pull_request in to_review[state]: %}
      <div class="pull-request">
        <h4>{{ utils.truncated_title(pull_request.title, pull_request.url) }}</h4>
        <p class="tagline">
          {{ utils.timestamp(pull_request.state_for_user(username).timestamp, review_deadline if blocker else None) }}
          &middot;
          <a href="/user/{{ pull_request.author }}" target="_self">@{{ pull_request.author }}</a>
          &middot;
          <a href="/repo/{{ pull_request.repository }}" target="_self">{{ pull_request.repository }}</a>#{{ pull_request.id }}
        </p>
      </div>
      {% else %}
      {% if blocker and not username_overridden %}
      <p class="nada">all clear! thank you</p>
      {% else %}
      <p class="nada" lang="es">nada</p>
      {% endif %}
      {% endfor %}
      </details>
    {% endfor %}
  </section>

  <section class="listing">
    {% if not username_overridden: %}
    <h2>my pull requests (don't let these linger)</h2>
    {% else %}
    <h2>@{{username}}'s pull requests</h2>
    {% endif %}

    {% for state in ["fish", "eyeglasses", "nail_care", "unreviewed", "haircut"]: %}
    <details open>
      <summary>
        <h3 class="state-{{ state }}">{{ state_meanings[state] }} <span class="count">({{ my_pulls[state] | length }})</span></h3>
      </summary>
      {% for pull_request in my_pulls[state]: %}
      <div class="pull-request">
        <ul class="review-states">
          {% for user, state in pull_request.current_states().iteritems(): %}
            {% if user != pull_request.author or state.state != "unreviewed": %}
            <li title="@{{ user }}: {{ state_meanings[state.state] }}" class="state state-{{ state.state }}"><a href="/user/{{user}}" target="_self">:{{ state.state }}:</a></li>
            {% endif %}
          {% endfor %}
        </ul>

        <h4>{{ utils.truncated_title(pull_request.title, pull_request.url) }}</h4>
        <p class="tagline">
          {{ utils.timestamp(pull_request.created, merge_deadline) }}
          &middot;
          <a href="/repo/{{ pull_request.repository }}" target="_self">{{ pull_request.repository }}</a>#{{ pull_request.id }}
        </p>
      </div>
      {% else %}
      <p class="nada" lang="es">nada</p>
      {% endfor %}
    </details>
    {% endfor %}
  </section>

  <footer>
    <a href="https://github.com/spladug/harold/wiki/Code-Salon-Emoji">what do all these emoji mean?</a>
  </footer>

  <script src="{{ url_for('static', filename='js/jquery.js') }}"></script>
  <script src="{{ url_for('static', filename='js/timetext.js') }}"></script>

{% endblock %}
